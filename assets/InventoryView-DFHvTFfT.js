import{d as H,r as g,c as A,w as J,a as D,b as y,t as C,n as oe,F as M,e as X,f as re,o as x,_ as Y,g as se,s as ce,u as ie,h as le,i as ue,R as de}from"./index-BOaC0vfq.js";const pe={id:"container"},fe=["size"],he={disabled:""},me=["value"],ye=H({__name:"StrictInput",props:{options:{},prompt:{},required:{type:Boolean},default:{},size:{}},setup(t){const e=g(null),n=g(null),l=t,c=g(""),d=g(""),s=g(""),i=g(-1),a=g(!1);let r=0,h=0,u="";const p=A(()=>l.options.filter(o=>o.name.toUpperCase().includes(c.value.toUpperCase()))),v=A(()=>{const o=p.value.length;return`${o} Choice${o>1?"s":""}...`});J(()=>{if(console.log("--> watchEffect()"),console.time("<-- watchEffect()"),console.log(`   updating: option = ${i.value}, typed = '${c.value}'`),n.value&&e.value&&i.value!==-1){const o=p.value[i.value].name,f=o.toUpperCase().indexOf(c.value.toUpperCase());d.value=o.substring(0,f),S(),e.value.textContent=o.substring(f,f+c.value.length),u=e.value.textContent,setTimeout(()=>I(),0),s.value=o.substring(f+c.value.length),setTimeout(()=>{n.value&&(n.value.selectedIndex=i.value+1)},0)}else d.value="",s.value="",n.value&&(n.value.value="");console.timeEnd("<-- watchEffect()")});function m(o){return l.options.some(f=>f.name.toUpperCase().includes(o.toUpperCase()))}async function I(){console.log(`   restoring selection [${r}, ${h}]`),await re();const o=document.getSelection();e.value&&o&&o.containsNode(e.value,!0)&&(e.value.firstChild?o.setBaseAndExtent(e.value.firstChild,r,e.value.firstChild,h):o.setBaseAndExtent(e.value,0,e.value,0))}function S(){console.log("--> getSelection()"),console.time("<-- getSelection()");const o=e.value,f=document.getSelection();!o||!f||f.type==="None"||(f.containsNode(o,!0)&&(r=f.anchorOffset,h=f.focusOffset),console.log(`   captured selection: [${r}, ${h}]`),console.timeEnd("<-- getSelection()"))}function te(){var f,b;console.log("--> handleInput()"),console.time("<-- handleInput()");const o=(b=(f=e.value)==null?void 0:f.textContent)==null?void 0:b.replaceAll(" "," ");console.log(`'${o}'`),o!=null&&m(o)?(a.value=!1,c.value=o,u=o,i.value=c.value.length>0?0:-1):e.value&&(a.value=!0,e.value.textContent=u,I()),console.timeEnd("<-- handleInput()")}function O(o){var f,b,k,q,V,L,U,W;switch(o.target.id){case"pre":(k=document.getSelection())==null||k.setBaseAndExtent(((f=e.value)==null?void 0:f.firstChild)??e.value,0,((b=e.value)==null?void 0:b.firstChild)??e.value,0);break;case"post":case"user-input":(q=e.value)!=null&&q.firstChild?(U=document.getSelection())==null||U.setBaseAndExtent(e.value.firstChild,((V=e.value.firstChild.textContent)==null?void 0:V.length)??0,e.value.firstChild,((L=e.value.firstChild.textContent)==null?void 0:L.length)??0):(W=document.getSelection())==null||W.setBaseAndExtent(e.value,0,e.value,0);break;default:console.log(o.target);break}}function ne(o){if(console.log("--> navigateOptions()"),console.time("<-- navigateOptions()"),o.key.length>1){switch(S(),o.key){case"Tab":break;case"ArrowUp":if(o.preventDefault(),o.ctrlKey){i.value=0;break}i.value===0?i.value=p.value.length-1:i.value--;break;case"ArrowDown":if(o.preventDefault(),o.ctrlKey){i.value=p.value.length-1;break}i.value===p.value.length-1?i.value=0:i.value++;break}I()}console.timeEnd("<-- navigateOptions()")}function ae(o){console.log("--> chooseOption()"),console.time("<-- chooseOption()"),n.value&&(console.log(`***Select Event: value = ${n.value.selectedOptions[0].text}
    selectedIndex = ${n.value.selectedIndex}
    isTrusted = ${o.isTrusted}`),i.value=n.value.selectedIndex-1),console.timeEnd("<-- chooseOption()")}return(o,f)=>(x(),D("div",pe,[y("p",null,"Current index = "+C(i.value),1),f[0]||(f[0]=y("label",{for:"select"},"Weapon Name",-1)),y("div",{id:"user-input",onClick:O,class:oe({error:a.value})},[y("span",{id:"pre",class:"auto-text",onClick:O},C(d.value),1),y("span",{id:"input",ref_key:"input",ref:e,contenteditable:"true",spellcheck:"false",onInput:te,onBeforeinput:S,onClick:O,onKeydown:ne},null,544),y("span",{id:"post",class:"auto-text",onClick:O},C(s.value),1)],2),y("select",{ref_key:"select",ref:n,id:"select",autocomplete:"off",tabindex:"-1",size:Math.min(15,p.value.length+1),onChange:ae},[y("option",he,C(v.value),1),(x(!0),D(M,null,X(p.value,({name:b,id:k})=>(x(),D("option",{key:k,value:k},C(b),9,me))),128))],40,fe)]))}}),ve=Y(ye,[["__scopeId","data-v-52d18509"]]),_=(t,e)=>e.some(n=>t instanceof n);let z,K;function ge(){return z||(z=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ie(){return K||(K=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const N=new WeakMap,E=new WeakMap,P=new WeakMap;function be(t){const e=new Promise((n,l)=>{const c=()=>{t.removeEventListener("success",d),t.removeEventListener("error",s)},d=()=>{n(w(t.result)),c()},s=()=>{l(t.error),c()};t.addEventListener("success",d),t.addEventListener("error",s)});return P.set(e,t),e}function we(t){if(N.has(t))return;const e=new Promise((n,l)=>{const c=()=>{t.removeEventListener("complete",d),t.removeEventListener("error",s),t.removeEventListener("abort",s)},d=()=>{n(),c()},s=()=>{l(t.error||new DOMException("AbortError","AbortError")),c()};t.addEventListener("complete",d),t.addEventListener("error",s),t.addEventListener("abort",s)});N.set(t,e)}let $={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return N.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return w(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Z(t){$=t($)}function xe(t){return Ie().includes(t)?function(...e){return t.apply(T(this),e),w(this.request)}:function(...e){return w(t.apply(T(this),e))}}function Se(t){return typeof t=="function"?xe(t):(t instanceof IDBTransaction&&we(t),_(t,ge())?new Proxy(t,$):t)}function w(t){if(t instanceof IDBRequest)return be(t);if(E.has(t))return E.get(t);const e=Se(t);return e!==t&&(E.set(t,e),P.set(e,t)),e}const T=t=>P.get(t);function ke(t,e,{blocked:n,upgrade:l,blocking:c,terminated:d}={}){const s=indexedDB.open(t,e),i=w(s);return l&&s.addEventListener("upgradeneeded",a=>{l(w(s.result),a.oldVersion,a.newVersion,w(s.transaction),a)}),n&&s.addEventListener("blocked",a=>n(a.oldVersion,a.newVersion,a)),i.then(a=>{d&&a.addEventListener("close",()=>d()),c&&a.addEventListener("versionchange",r=>c(r.oldVersion,r.newVersion,r))}).catch(()=>{}),i}const Ce=["get","getKey","getAll","getAllKeys","count"],De=["put","add","delete","clear"],B=new Map;function R(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(B.get(e))return B.get(e);const n=e.replace(/FromIndex$/,""),l=e!==n,c=De.includes(n);if(!(n in(l?IDBIndex:IDBObjectStore).prototype)||!(c||Ce.includes(n)))return;const d=async function(s,...i){const a=this.transaction(s,c?"readwrite":"readonly");let r=a.store;return l&&(r=r.index(i.shift())),(await Promise.all([r[n](...i),c&&a.done]))[0]};return B.set(e,d),d}Z(t=>({...t,get:(e,n,l)=>R(e,n)||t.get(e,n,l),has:(e,n)=>!!R(e,n)||t.has(e,n)}));const Oe=["continue","continuePrimaryKey","advance"],Q={},F=new WeakMap,ee=new WeakMap,Pe={get(t,e){if(!Oe.includes(e))return t[e];let n=Q[e];return n||(n=Q[e]=function(...l){F.set(this,ee.get(this)[e](...l))}),n}};async function*Ee(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,Pe);for(ee.set(n,e),P.set(n,T(e));e;)yield n,e=await(F.get(n)||e.continue()),F.delete(n)}function G(t,e){return e===Symbol.asyncIterator&&_(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&_(t,[IDBIndex,IDBObjectStore])}Z(t=>({...t,get(e,n,l){return G(e,n)?Ee:t.get(e,n,l)},has(e,n){return G(e,n)||t.has(e,n)}}));const Be="https://script.google.com/macros/s/AKfycbwYVxIgMyWA9WsvHen7C823cxOIkr5wiMX11IqgDzPcQOeb79dJ0g0jmlo_P1PuebQ1/exec";async function j(t,e){console.log("    -->getGameData()");const n=Array.isArray(t)?t:[t];if(e!==void 0&&(e=Array.isArray(e)?e:[e],e.length!==n.length))throw new SyntaxError("If provided, the length of 'freshness' must match the length of 'requestedObjects'.");const l=await Promise.all(n.map(async(d,s)=>{const i=Date.now();console.log(`       Fetching ${d}...`);const r=await(await fetch(`${Be}?obj=${d}${e!==void 0?`&freshness=${e[s]}`:""}`)).json();if(r.status===400)throw new SyntaxError(`Invalid API request: ${r.message}`);return r.status===206&&console.warn(`⚠️ Check API request: ${r.message}`),console.log(`       ...${Date.now()-i}ms to retrieve ${d} (${r.time}ms API generation)`),r.reply}));let c=l[0];return l.forEach(d=>c={...c,...d}),c}const je=se("appDatabase",()=>{const t=g("closed"),e=g(!1),n=g(!0);let l;d();async function c(a,r){return(await l.getAll(a)).map(u=>Object.fromEntries(Ae(u).filter(([p,v])=>r?r.includes(p):!0)))}async function d(){console.time("open database"),l=await ke("TCTD2lbox_App",1,{async upgrade(a){t.value="initializing...",console.log("...creating App database"),a.createObjectStore("appColors",{keyPath:"id"}).createIndex("byCategory","category",{unique:!0}),a.createObjectStore("appData"),a.createObjectStore("appDisplayTypes",{keyPath:"id"}).createIndex("byType","type",{unique:!0});const r=a.createObjectStore("dictionary",{keyPath:"id"});r.createIndex("byCategory","category"),r.createIndex("byCode","codeName"),r.createIndex("byPretty","prettyName"),a.createObjectStore("lastFetch",{keyPath:"store"}),a.createObjectStore("gearAttributes",{keyPath:"id"}),a.createObjectStore("gearBrands",{keyPath:"id"}).createIndex("byName","name",{unique:!0}),a.createObjectStore("gearModAttributes",{keyPath:"id"});const h=a.createObjectStore("gearModels",{keyPath:"id"});h.createIndex("byName","name",{unique:!0}),h.createIndex("bySlot","slot"),a.createObjectStore("gearQuality",{keyPath:"id"}).createIndex("byName","name",{unique:!0}),a.createObjectStore("gearSlots",{keyPath:"id"}).createIndex("byName","name",{unique:!0}),a.createObjectStore("gearTalents",{keyPath:"id"}).createIndex("byName","name",{unique:!0}),a.createObjectStore("skillMods",{keyPath:"id"}),a.createObjectStore("skillPlatforms",{keyPath:"id"}).createIndex("byName","name",{unique:!0}),a.createObjectStore("skillSlots",{keyPath:"id"}).createIndex("byName","name");const u=a.createObjectStore("skillVariants",{keyPath:"id"});u.createIndex("byName","name"),u.createIndex("byPlatform","platform"),a.createObjectStore("specializations",{keyPath:"id"}).createIndex("byName","name",{unique:!0}),a.createObjectStore("storage",{keyPath:"id"}),a.createObjectStore("watchAttributes",{keyPath:"id"}),a.createObjectStore("weaponAttributes",{keyPath:"id"}),a.createObjectStore("weaponClass",{keyPath:"id"}).createIndex("byName","name",{unique:!0});const p=a.createObjectStore("weaponModels",{keyPath:"id"});p.createIndex("byName","name",{unique:!0}),p.createIndex("byClass","class");const v=a.createObjectStore("weaponMods",{keyPath:"id"});v.createIndex("byName","name"),v.createIndex("bySlot","slot"),v.createIndex("byType","type",{multiEntry:!0}),a.createObjectStore("weaponQuality",{keyPath:"id"}).createIndex("byName","name",{unique:!0}),a.createObjectStore("weaponSubClass",{keyPath:"id"}).createIndex("byName","name",{unique:!0}),a.createObjectStore("weaponTalents",{keyPath:"id"}).createIndex("byName","name",{unique:!0}),await i(a),t.value="ready",n.value=!1}}),console.timeEnd("open database"),e.value=!0,t.value==="closed"&&(t.value="ready",s())}async function s(){const a=j("lastUpdated"),r=[];console.time("DB getAll");const h={};if((await l.getAll("lastFetch")).forEach(u=>h[u.store]=u.lastFetch),console.timeEnd("DB getAll"),(await a).lastUpdated.data.forEach(u=>{u.updated>h[u.store]&&r.push(u.store)}),console.log(r),r.length>0){const u=r.map(m=>h[m]),p=await j(r,u);console.log(p);const v=Object.keys(p).map(m=>{if(console.log(`updating ${m}`),p[m].data.length===0)return null;const I=l.transaction(["lastFetch",m],"readwrite");return p[m].data.forEach(S=>I.objectStore(m).put(S)),I.objectStore("lastFetch").put({store:m,lastFetch:p[m].served}),I.done});await Promise.all(v)}n.value=!1}async function i(a){console.log("--> stockDB()"),console.time("<-- stockDB()");const h=[...a.objectStoreNames].map(async u=>{if(u==="appData"||u==="lastFetch")return null;console.log(`    stocking ${u}...`);const p=await j(u);if(p[u].data.length===0)return null;const v=a.transaction(["lastFetch",u],"readwrite");return p[u].data.forEach(m=>v.objectStore(u).add(m)),v.objectStore("lastFetch").add({store:u,lastFetch:p[u].served}),v.done});await Promise.all(h),console.timeEnd("<-- stockDB()")}return{dbIsOpen:e,dbStatus:t,dbMayBeStale:n,getData:c}});function Ae(t){return Object.entries(t)}const Me={class:"inventory app-grid-main"},_e={class:"app-grid-left"},Ne=H({__name:"InventoryView",setup(t){const e=je(),{menuItemData:n}=ce(ie()),l=A(()=>n.value[1].children),c=g([]);return J(async()=>{c.value=(await e.getData("weaponModels",["name","id"])).sort((d,s)=>d.name>s.name?1:-1)}),(d,s)=>(x(),D(M,null,[y("main",Me,[s[0]||(s[0]=y("h1",null,"This is the Inventory page",-1)),s[1]||(s[1]=y("input",null,null,-1)),le(ve,{options:c.value},null,8,["options"]),s[2]||(s[2]=y("input",null,null,-1))]),y("nav",_e,[(x(!0),D(M,null,X(l.value,i=>(x(),ue(de,{key:i.routeName,"route-name":"links",text:i.descriptor,"shortcut-key":i.shortcutKey,class:"nav-button"},null,8,["text","shortcut-key"]))),128))])],64))}}),Te=Y(Ne,[["__scopeId","data-v-597011b7"]]);export{Te as default};
